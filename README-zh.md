<div align="center">
  <h1>ğŸ” Lares æ¸¸æˆè´¦å·é‰´æƒæœåŠ¡</h1>
  <p><em>ä¸“ä¸šæ¸¸æˆè´¦å·è®¤è¯æœåŠ¡ï¼Œå…·å¤‡åŒä»¤ç‰Œæ¶æ„å’Œå¤šå¹³å°ç™»å½•æ”¯æŒ</em></p>
</div>

<p align="center">
<a href="https://github.com/go-pantheon/lares/actions"><img src="https://github.com/go-pantheon/lares/workflows/Go/badge.svg" alt="æ„å»ºçŠ¶æ€"></a>
<a href="https://github.com/go-pantheon/lares/releases"><img src="https://img.shields.io/github/v/release/go-pantheon/lares" alt="æœ€æ–°ç‰ˆæœ¬"></a>
<a href="https://github.com/go-kratos/kratos"><img src="https://img.shields.io/badge/Kratos-v2.8.4-blue" alt="Kratos"></a>
<a href="https://pkg.go.dev/github.com/go-pantheon/lares"><img src="https://pkg.go.dev/badge/github.com/go-pantheon/lares" alt="GoDoc"></a>
<a href="https://goreportcard.com/report/github.com/go-pantheon/lares"><img src="https://goreportcard.com/badge/github.com/go-pantheon/lares" alt="Go Report Card"></a>
<a href="https://github.com/go-pantheon/lares/blob/main/LICENSE"><img src="https://img.shields.io/github/license/go-pantheon/lares" alt="è®¸å¯è¯"></a>
<a href="https://deepwiki.com/go-pantheon/lares"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</p>

<p align="center">
  <a href="README.md">English</a> | <a href="README-zh.md">ä¸­æ–‡</a>
</p>

## å…³äº Lares

**Lares** æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¸¸æˆè´¦å·è®¤è¯æœåŠ¡ï¼Œä¸ºç°ä»£æ¸¸æˆåº”ç”¨æä¾›å®‰å…¨ã€é«˜æ€§èƒ½çš„èº«ä»½éªŒè¯è§£å†³æ–¹æ¡ˆã€‚Lares é‡‡ç”¨åŒä»¤ç‰Œæ¶æ„ï¼ˆSession + AuthTokenï¼‰ï¼ŒåŸç”Ÿæ”¯æŒ Apple/Google/Facebook ç™»å½•ï¼Œå¹¶å…·å¤‡æ¸¸æˆä¼˜åŒ–åŠŸèƒ½ï¼Œå¦‚åŸºäºæŸ“è‰²é€‰æ‹©å’ŒæœåŠ¡å™¨è·¯ç”±ç­‰ç‰¹æ€§ï¼Œå°†å¤æ‚çš„è®¤è¯æŒ‘æˆ˜è½¬åŒ–ä¸ºç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿æ¸¸æˆå¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿå®ç°èº«ä»½éªŒè¯ï¼ŒåŒæ—¶ä¿æŒä¼ä¸šçº§çš„å®‰å…¨æ€§å’Œå¤§è§„æ¨¡æ€§èƒ½ã€‚

## å…³äº go-pantheon ç”Ÿæ€ç³»ç»Ÿ

**go-pantheon** æ˜¯ä¸€ä¸ªå¼€ç®±å³ç”¨çš„æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶ï¼ŒåŸºäºå¾®æœåŠ¡æ¶æ„æä¾›é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ¸¸æˆæœåŠ¡å™¨é›†ç¾¤è§£å†³æ–¹æ¡ˆã€‚Lares ä½œä¸ºèº«ä»½éªŒè¯ä¸­å¿ƒï¼Œä¸å…¶ä»–æ ¸å¿ƒæœåŠ¡åä½œæ„æˆå®Œæ•´çš„æ¸¸æˆæœåŠ¡ç”Ÿæ€ç³»ç»Ÿï¼š

- **Roma**: æ¸¸æˆæ ¸å¿ƒä¸šåŠ¡æœåŠ¡ï¼Œè´Ÿè´£æ¸¸æˆé€»è¾‘å¤„ç†å’Œæ•°æ®ç®¡ç†
- **Janus**: ç½‘å…³æœåŠ¡ï¼Œè´Ÿè´£å®¢æˆ·ç«¯è¿æ¥å¤„ç†å’Œè¯·æ±‚è½¬å‘
- **Lares**: è´¦æˆ·é‰´æƒæœåŠ¡ï¼Œè´Ÿè´£ç”¨æˆ·è®¤è¯å’Œè´¦æˆ·ç®¡ç†
- **Senate**: åå°ç®¡ç†æœåŠ¡ï¼Œæä¾›è¿è¥ç®¡ç†æ¥å£

## æ ¸å¿ƒä¼˜åŠ¿

### ğŸ”’ å®‰å…¨å¯é 
- **ä¼ä¸šçº§åŠ å¯†**: å¤šé‡åŠ å¯†ä¿æŠ¤ï¼Œé˜²æ­¢è´¦å·è¢«ç›—
- **é˜²é‡æ”¾æ”»å‡»**: ç¡®ä¿æ¯æ¬¡è¯·æ±‚çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§
- **ç¬¬ä¸‰æ–¹å¹³å°éªŒè¯**: æ”¯æŒä¸»æµç¤¾äº¤å¹³å°å®‰å…¨æ¥å…¥

### ğŸŒ å¤šå¹³å°ç™»å½•
- **ä¼ ç»Ÿè´¦å·**: ç”¨æˆ·å/å¯†ç æ³¨å†Œç™»å½•
- **Apple ç™»å½•**: æ”¯æŒ Web å’Œ App åŒç«¯
- **Google ç™»å½•**: æ ‡å‡† OAuth2 æµç¨‹
- **Facebook ç™»å½•**: ç¤¾äº¤è´¦æˆ·å¿«é€Ÿæ¥å…¥

### âš¡ é«˜æ€§èƒ½æ¶æ„
- **å¾®æœåŠ¡è®¾è®¡**: æ”¯æŒæ°´å¹³æ‰©å±•å’Œåˆ†å¸ƒå¼éƒ¨ç½²
- **åŒåè®®æ”¯æŒ**: åŒæ—¶æä¾› gRPC å’Œ HTTP æ¥å£
- **å¿«é€ŸTokenç”Ÿæˆ**: é«˜æ•ˆçš„ä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯æœºåˆ¶

### ğŸ® æ¸¸æˆç”Ÿæ€æ— ç¼é›†æˆ
- **ç‹¬ç«‹éªŒè¯**: Janusç½‘å…³å¯è‡ªè¡ŒéªŒè¯Tokenï¼Œå“åº”æ›´å¿«
- **è¿è¥æ”¯æ’‘**: å†…ç½®å…¬å‘Šç³»ç»Ÿï¼Œæ”¯æŒæ¸¸æˆè¿è¥
- **çµæ´»æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

## ç³»ç»Ÿæ¶æ„

### ç³»ç»Ÿæ¶æ„æ€»è§ˆ

**ç»„ä»¶å…³ç³»å›¾ï¼š**

```mermaid
graph TB
    Client["ğŸ® æ¸¸æˆå®¢æˆ·ç«¯"]
    Lares["ğŸ” Lares<br/>(è´¦å·é‰´æƒæœåŠ¡)"]
    Janus["ğŸ”° Janus<br/>(ç½‘å…³æœåŠ¡)"]
    Senate["ğŸ“Š Senate<br/>(ç®¡ç†æœåŠ¡)"]

    subgraph Roma["âš™ï¸ Roma æ¸¸æˆæœåŠ¡é›†ç¾¤"]
        direction LR
        Player["ğŸ‘¤ PlayeræœåŠ¡"]
        Room["ğŸ  RoomæœåŠ¡"]
        Team["ğŸ¤ TeamæœåŠ¡"]
        Other["... å…¶ä»–æœåŠ¡"]
    end

    subgraph ThirdParty["ğŸŒ ç¬¬ä¸‰æ–¹å¹³å°"]
        direction LR
        Apple["Apple"]
        Google["Google"]
        Facebook["Facebook"]
    end

    subgraph OwnAccount["ğŸ” è‡ªæœ‰è´¦å·ç³»ç»Ÿ"]
        direction LR
        Register["ğŸ“ æ³¨å†Œç™»å½•"]
        Session["ğŸ« Sessionç®¡ç†"]
        Renewal["ğŸ”„ Sessionç»­æœŸ"]
    end

    Client -->|"1.èº«ä»½éªŒè¯è¯·æ±‚"| Lares
    ThirdParty -->|"ä»¤ç‰ŒéªŒè¯"| Lares
    OwnAccount -->|"è´¦å·å¯†ç /SessionéªŒè¯"| Lares
    Lares -->|"è¿”å›Account Token + Session"| Client
    Client -->|"2.æ¸¸æˆè¿æ¥+Token"| Janus
    Janus -->|"3.gRPC è°ƒç”¨"| Player
    Janus -->|"gRPC è°ƒç”¨"| Room
    Janus -->|"gRPC è°ƒç”¨"| Team
    Player -->|"ä¸šåŠ¡å“åº”"| Janus
    Room -->|"ä¸šåŠ¡å“åº”"| Janus
    Team -->|"ä¸šåŠ¡å“åº”"| Janus
    Janus -->|"4.æ¸¸æˆæ•°æ®"| Client
    Lares -.->|"ç”¨æˆ·æ•°æ®"| Senate

    classDef clientStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef laresStyle fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    classDef serviceStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef gatewayStyle fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef thirdPartyStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef ownAccountStyle fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px

    class Client clientStyle
    class Lares laresStyle
    class Janus gatewayStyle
    class Senate serviceStyle
    class Player,Room,Team,Other serviceStyle
    class Apple,Google,Facebook thirdPartyStyle
    class Register,Session,Renewal ownAccountStyle
```

### Lares å†…éƒ¨æ¶æ„

**Lares æœåŠ¡æ¶æ„å›¾ï¼š**

```mermaid
graph TB
    subgraph Lares["ğŸ” Lares è´¦å·é‰´æƒæœåŠ¡"]
        direction TB

        subgraph Services["å¾®æœåŠ¡æ¨¡å—"]
            direction LR

            subgraph Account["ğŸ‘¤ Account æœåŠ¡"]
                AccountAPI["API å±‚"]
                AccountBiz["ä¸šåŠ¡å±‚"]
                AccountData["æ•°æ®å±‚"]
            end

            subgraph Notice["ğŸ“¢ Notice æœåŠ¡"]
                NoticeAPI["API å±‚"]
                NoticeBiz["ä¸šåŠ¡å±‚"]
                NoticeData["æ•°æ®å±‚"]
            end

            subgraph Future["ğŸ”® æœªæ¥æœåŠ¡"]
                ServerAPI["åŒºæœç®¡ç† API"]
                ServerBiz["åŒºæœç®¡ç†ä¸šåŠ¡"]
                ServerData["åŒºæœç®¡ç†æ•°æ®"]
            end
        end

        subgraph Security["ğŸ›¡ï¸ å®‰å…¨ç»„ä»¶"]
            direction LR
            JWT["JWT éªŒè¯å™¨"]
            AES["AES åŠ å¯†å™¨"]
            Password["å¯†ç å“ˆå¸Œå™¨"]
            Session["ä¼šè¯ç®¡ç†å™¨"]
        end

        subgraph Platform["ğŸŒ å¹³å°é›†æˆ"]
            direction LR
            AppleDomain["Apple éªŒè¯"]
            GoogleDomain["Google éªŒè¯"]
            FacebookDomain["Facebook éªŒè¯"]
        end
    end

    subgraph Infrastructure["åŸºç¡€è®¾æ–½"]
        direction LR
        PostgreSQL["PostgreSQL<br/>ç”¨æˆ·æ•°æ®å­˜å‚¨"]
        Etcd["etcd<br/>æœåŠ¡å‘ç°"]
    end

    subgraph External["å¤–éƒ¨æœåŠ¡"]
        direction LR
        AppleAuth["Apple è®¤è¯æœåŠ¡"]
        GoogleAuth["Google è®¤è¯æœåŠ¡"]
        FacebookAuth["Facebook è®¤è¯æœåŠ¡"]
    end

    AccountData -.->|"ç”¨æˆ·æ•°æ®"| PostgreSQL
    NoticeData -.->|"å…¬å‘Šæ•°æ®"| PostgreSQL
    AccountAPI -.->|"æœåŠ¡æ³¨å†Œ"| Etcd
    NoticeAPI -.->|"æœåŠ¡æ³¨å†Œ"| Etcd

    AppleDomain -.->|"ä»¤ç‰ŒéªŒè¯"| AppleAuth
    GoogleDomain -.->|"ä»¤ç‰ŒéªŒè¯"| GoogleAuth
    FacebookDomain -.->|"ä»¤ç‰ŒéªŒè¯"| FacebookAuth

    AccountBiz -.->|"ä½¿ç”¨"| JWT
    AccountBiz -.->|"ä½¿ç”¨"| AES
    AccountBiz -.->|"ä½¿ç”¨"| Password
    AccountBiz -.->|"ä½¿ç”¨"| Session

    classDef serviceStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef securityStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef infraStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef externalStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px

    class AccountAPI,AccountBiz,AccountData,NoticeAPI,NoticeBiz,NoticeData,ServerAPI,ServerBiz,ServerData serviceStyle
    class JWT,AES,Password,Session,AppleDomain,GoogleDomain,FacebookDomain securityStyle
    class PostgreSQL,Redis,Etcd infraStyle
    class AppleAuth,GoogleAuth,FacebookAuth externalStyle
```

### è®¤è¯æµç¨‹è¯¦è§£

**å®Œæ•´çš„ç”¨æˆ·è®¤è¯æµç¨‹ï¼š**

```mermaid
sequenceDiagram
    participant C as ğŸ® æ¸¸æˆå®¢æˆ·ç«¯
    participant L as ğŸ” Lares
    participant TP as ğŸŒ ç¬¬ä¸‰æ–¹å¹³å°
    participant OA as ğŸ” è‡ªæœ‰è´¦å·ç³»ç»Ÿ
    participant J as ğŸ”° Janus
    participant R as âš™ï¸ RomaæœåŠ¡

    Note over C,R: æ–¹å¼ä¸€ï¼šç¬¬ä¸‰æ–¹å¹³å°ç™»å½•
    C->>L: 1.1 å‘é€ç¬¬ä¸‰æ–¹ç™»å½•è¯·æ±‚
    L->>TP: 1.2 éªŒè¯ç¬¬ä¸‰æ–¹ä»¤ç‰Œ
    TP-->>L: 1.3 è¿”å›ç”¨æˆ·ä¿¡æ¯
    L->>L: 1.4 ç”Ÿæˆ/æ›´æ–°ç”¨æˆ·è´¦æˆ·
    L->>L: 1.5 ç”ŸæˆAccount Token + Session
    L-->>C: 1.6 è¿”å›Account Token + Session

    Note over C,R: æ–¹å¼äºŒï¼šè‡ªæœ‰è´¦å·æ³¨å†Œ/ç™»å½•
    C->>L: 2.1 å‘é€æ³¨å†Œ/ç™»å½•è¯·æ±‚(ç”¨æˆ·å+å¯†ç )
    L->>OA: 2.2 éªŒè¯è´¦å·å¯†ç 
    OA-->>L: 2.3 è¿”å›éªŒè¯ç»“æœ
    L->>L: 2.4 ç”Ÿæˆ/æ›´æ–°ç”¨æˆ·è´¦æˆ·
    L->>L: 2.5 ç”ŸæˆAccount Token + Session
    L-->>C: 2.6 è¿”å›Account Token + Session

    Note over C,R: æ–¹å¼ä¸‰ï¼šSessionå¿«é€Ÿç™»å½•
    C->>L: 3.1 å‘é€Sessionç™»å½•è¯·æ±‚
    L->>OA: 3.2 éªŒè¯Sessionæœ‰æ•ˆæ€§
    OA-->>L: 3.3 SessionéªŒè¯é€šè¿‡
    L->>L: 3.4 ç”Ÿæˆæ–°çš„Account Token
    L-->>C: 3.5 è¿”å›Account Token

    Note over C,R: æ–¹å¼å››ï¼šSessionç»­æœŸ(ç‹¬ç«‹æ“ä½œ)
    C->>L: 4.1 å‘é€Sessionç»­æœŸè¯·æ±‚
    L->>OA: 4.2 éªŒè¯Sessionæœ‰æ•ˆæ€§
    OA-->>L: 4.3 SessionéªŒè¯é€šè¿‡
    L->>L: 4.4 å»¶é•¿Sessionæœ‰æ•ˆæœŸ
    L-->>C: 4.5 è¿”å›æ–°çš„ç»­æœŸSession

    Note over C,R: æ¸¸æˆè¿æ¥é˜¶æ®µ
    C->>J: 5.1 å»ºç«‹TCPè¿æ¥
    C->>J: 5.2 å‘é€æ¡æ‰‹è¯·æ±‚(å«Token)
    J->>J: 5.3 éªŒè¯Account Token
    J-->>C: 5.4 æ¡æ‰‹æˆåŠŸå“åº”

    Note over C,R: æ¸¸æˆäº¤äº’é˜¶æ®µ
    C->>J: 6.1 å‘é€æ¸¸æˆåè®®
    J->>R: 6.2 è½¬å‘ä¸ºgRPCè°ƒç”¨
    R->>R: 6.3 å¤„ç†æ¸¸æˆé€»è¾‘
    R-->>J: 6.4 è¿”å›å¤„ç†ç»“æœ
    J-->>C: 6.5 è½¬å‘æ¸¸æˆå“åº”
```

## æ ¸å¿ƒæ¦‚å¿µ

### ğŸ”‘ Session ä¼šè¯æœºåˆ¶

Session æ˜¯å®¢æˆ·ç«¯ç¼“å­˜çš„ç©å®¶ç™»å½•æ ‡è¯†ï¼Œç”¨äºç»´æŠ¤ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼š

```proto
message Session {
  int64 account_id = 1;    // è´¦æˆ·ID
  int64 timeout = 2;       // è¿‡æœŸæ—¶é—´æˆ³
  string key = 3;          // éšæœºå­—ç¬¦ä¸²
}
```

**ç‰¹æ€§ï¼š**
- ğŸ•’ **è‡ªåŠ¨è¿‡æœŸ**: ç¡®ä¿å®‰å…¨ï¼Œé˜²æ­¢é•¿æœŸæ»¥ç”¨
- ğŸ” **å®‰å…¨å­˜å‚¨**: åŠ å¯†ä¿æŠ¤ï¼Œé˜²æ­¢ä¼šè¯åŠ«æŒ
- ğŸ”„ **çµæ´»ç»­æœŸ**: æ”¯æŒå»¶é•¿æœ‰æ•ˆæœŸ
- ğŸ“± **å…é‡å¤ç™»å½•**: æå‡ç”¨æˆ·ä½“éªŒ

### ğŸ« AuthToken è®¤è¯ä»¤ç‰Œ

AuthToken æ˜¯å®¢æˆ·ç«¯ä¸ Janus ç½‘å…³æ¡æ‰‹æ—¶æºå¸¦çš„æ ¡éªŒä¿¡æ¯ï¼ŒåŒ…å«å®Œæ•´çš„ç”¨æˆ·èº«ä»½å’Œè·¯ç”±ä¿¡æ¯ï¼š

```proto
message AuthToken {
  string rand = 1;         // é˜²é‡æ”¾æ”»å‡»çš„éšæœºå­—ç¬¦ä¸²
  string color = 2;        // æŸ“è‰²æ ‡è¯†
  int64 account_id = 3;    // è´¦æˆ·ID
  int64 server_id = 4;     // æœåŠ¡å™¨ID
  int64 timeout = 5;       // è¿‡æœŸæ—¶é—´æˆ³
  int32 location = 6;      // ä½ç½®ä¿¡æ¯
  OnlineStatus status = 7; // è®¿é—®æ ‡è¯†
  bool unencrypted = 8;    // æœ¬æ¬¡è¿æ¥æ˜¯å¦å…³é—­åŠ å¯†
}
```

**ç‰¹æ€§ï¼š**
- ğŸ”’ **å®‰å…¨ä¼ è¾“**: åŠ å¯†ä¿æŠ¤ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
- ğŸ”„ **ä¿¡æ¯å®Œæ•´**: åŒ…å«ç”¨æˆ·è¿æ¥ä¿¡æ¯ï¼Œæ— éœ€é¢å¤–æŸ¥è¯¢
- ğŸ›¡ï¸ **é˜²æ”»å‡»**: ç¡®ä¿ä»¤ç‰Œå”¯ä¸€æ€§å’Œå®‰å…¨æ€§
- ğŸ¯ **æ™ºèƒ½è·¯ç”±**: æ”¯æŒè´Ÿè½½å‡è¡¡å’Œåˆ†å‘
- âš¡ **å¿«é€ŸéªŒè¯**: ç½‘å…³ç‹¬ç«‹éªŒè¯ï¼Œå“åº”æ›´å¿«
- ğŸ“ **çŠ¶æ€è¿½è¸ª**: æ”¯æŒåˆ†å¸ƒå¼æ¸¸æˆé€»è¾‘

## æœåŠ¡æ¨¡å—

Lares å½“å‰æ”¯æŒä»¥ä¸‹æœåŠ¡æ¨¡å—ï¼š

| æ¨¡å—        | çŠ¶æ€     | æè¿°         | åŠŸèƒ½                           |
| ----------- | -------- | ------------ | ------------------------------ |
| **Account** | âœ… å·²å®ç° | è´¦æˆ·ç®¡ç†æœåŠ¡ | ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ç¬¬ä¸‰æ–¹å¹³å°é›†æˆ |
| **Notice**  | âœ… å·²å®ç° | å…¬å‘Šç³»ç»ŸæœåŠ¡ | å…¬å‘Šå‘å¸ƒã€ç®¡ç†ã€å®¢æˆ·ç«¯æ¨é€     |
| **Server**  | ğŸ”® è§„åˆ’ä¸­ | åŒºæœç®¡ç†æœåŠ¡ | æ¸¸æˆåŒºæœåˆ›å»ºã€ç®¡ç†ã€è´Ÿè½½å‡è¡¡   |

### èº«ä»½éªŒè¯æ”¯æŒ

| è®¤è¯æ–¹å¼           | çŠ¶æ€       | æè¿°             | ç‰¹æ€§                   |
| ------------------ | ---------- | ---------------- | ---------------------- |
| **ç”¨æˆ·å/å¯†ç **    | âœ… å®Œæ•´æ”¯æŒ | ä¼ ç»Ÿè´¦å·æ³¨å†Œç™»å½• | å®‰å…¨åŠ å¯†ã€å¯†ç å¼ºåº¦éªŒè¯ |
| **Apple Sign In**  | âœ… å®Œæ•´æ”¯æŒ | Appleå®˜æ–¹ç™»å½•    | æ”¯æŒWeb/AppåŒç«¯        |
| **Google OAuth**   | âœ… å®Œæ•´æ”¯æŒ | Googleè´¦å·ç™»å½•   | æ ‡å‡†OAuth2æµç¨‹         |
| **Facebook Login** | âœ… å®Œæ•´æ”¯æŒ | Facebookç¤¾äº¤ç™»å½• | å¿«é€Ÿç¤¾äº¤æ¥å…¥           |

## æŠ€æœ¯æ ˆ

Lares ä½¿ç”¨ä»¥ä¸‹æ ¸å¿ƒæŠ€æœ¯ï¼š

| æŠ€æœ¯/ç»„ä»¶         | ç”¨é€”         | ç‰ˆæœ¬     |
| ----------------- | ------------ | -------- |
| **Go**            | ä¸»è¦å¼€å‘è¯­è¨€ | 1.24+    |
| **go-kratos**     | å¾®æœåŠ¡æ¡†æ¶   | v2.8.4   |
| **gRPC**          | æœåŠ¡é—´é€šä¿¡   | v1.73.0  |
| **Protobuf**      | æ•°æ®åºåˆ—åŒ–   | v1.36.6  |
| **etcd**          | æœåŠ¡å‘ç°æ³¨å†Œ | v3.6.1   |
| **PostgreSQL**    | ä¸»æ•°æ®åº“     | v5.7.5   |
| **OpenTelemetry** | åˆ†å¸ƒå¼è¿½è¸ª   | v1.37.0  |
| **Prometheus**    | ç›‘æ§ç³»ç»Ÿ     | v1.22.0  |
| **Google Wire**   | ä¾èµ–æ³¨å…¥     | v0.6.0   |
| **JWT**           | ä»¤ç‰ŒéªŒè¯     | v4.5.2   |
| **Argon2**        | å¯†ç å“ˆå¸Œ     | å†…ç½®æ”¯æŒ |

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Go 1.24+** - ä¸»è¦å¼€å‘è¯­è¨€
- **PostgreSQL 13+** - ä¸»æ•°æ®åº“
- **etcd 3.5+** - æœåŠ¡å‘ç°ä¸é…ç½®ä¸­å¿ƒ
- **protoc** - Protocol Buffers ç¼–è¯‘å™¨

### å®‰è£…

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/go-pantheon/lares.git
cd lares

# 2. åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ
make init

# 3. å®‰è£…ä¾èµ–
go mod download
```

### é…ç½®

```bash
# 1. å¤åˆ¶é…ç½®æ¨¡æ¿
cp app/account/configs.tmpl/config.yaml app/account/configs/config.yaml

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
vim app/account/configs/config.yaml
```

**å…³é”®é…ç½®é¡¹ï¼š**

```yaml
# æœåŠ¡é…ç½®
server:
  http:
    addr: 0.0.0.0:8001
  grpc:
    addr: 0.0.0.0:9001

# æ•°æ®åº“é…ç½®
data:
  postgresql:
    source: "postgres://user:password@localhost:5432/lares?sslmode=disable"

# ç¬¬ä¸‰æ–¹å¹³å°é…ç½®
platform:
  apple:
    client_id: "your_apple_client_id"
    team_id: "your_apple_team_id"
    key_id: "your_apple_key_id"
  google:
    aud: "your_google_client_id"
  facebook:
    app_id: "your_facebook_app_id"
    app_secret: "your_facebook_app_secret"

# å®‰å…¨é…ç½®
secret:
  token_key: "your_32_byte_token_encryption_key"
  session_key: "your_32_byte_session_encryption_key"
  platform_key: "your_32_byte_platform_encryption_key"
```

### å¯åŠ¨æœåŠ¡

```bash
# 1. ç”Ÿæˆä»£ç 
make generate

# 2. æ„å»ºæœåŠ¡
make build

# 3. å¯åŠ¨è´¦æˆ·æœåŠ¡
make run app=account

# 4. å¯åŠ¨å…¬å‘ŠæœåŠ¡
make run app=notice
```

### éªŒè¯æœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8001/accounts/v1/dev/ping

# æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8001/accounts/v1/username/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "SecurePassword123!",
    "color": "blue"
  }'
```

## API æ–‡æ¡£

### è´¦æˆ·ç®¡ç†æ¥å£

#### ç”¨æˆ·æ³¨å†Œ
```http
POST /accounts/v1/username/register
Content-Type: application/json

{
  "username": "player123",
  "password": "SecurePassword123!",
  "color": "blue"
}

# å“åº”ç¤ºä¾‹
{
  "info": {
    "account_id": "encoded_account_id",
    "register": true,
    "token": "encrypted_auth_token",      # AuthTokenï¼Œç”¨äºç½‘å…³æ¡æ‰‹
    "token_timeout": 1704067200,
    "session": "encrypted_session",       # Sessionï¼Œå®¢æˆ·ç«¯ç¼“å­˜
    "session_timeout": 1704153600,
    "state": "random_state_string"
  }
}
```

#### ç”¨æˆ·ç™»å½•
```http
POST /accounts/v1/username/login
Content-Type: application/json

{
  "username": "player123",
  "password": "SecurePassword123!",
  "color": "blue"
}

# å“åº”ç¤ºä¾‹
{
  "info": {
    "account_id": "encoded_account_id",
    "register": false,
    "token": "encrypted_auth_token",      # AuthTokenï¼Œç”¨äºç½‘å…³æ¡æ‰‹
    "token_timeout": 1704067200,
    "session": "encrypted_session",       # Sessionï¼Œå®¢æˆ·ç«¯ç¼“å­˜
    "session_timeout": 1704153600,
    "state": "random_state_string"
  }
}
```

#### ç¬¬ä¸‰æ–¹ç™»å½•
```http
# Apple ç™»å½•
POST /accounts/v1/apple/login
Content-Type: application/json

{
  "token": "apple_id_token",
  "color": "blue"
}

# Google ç™»å½•
POST /accounts/v1/google/login
Content-Type: application/json

{
  "token": "google_id_token",
  "color": "blue"
}

# Facebook ç™»å½•
POST /accounts/v1/fb/login
Content-Type: application/json

{
  "token": "facebook_access_token",
  "color": "blue"
}
```

#### è·å–æ¸¸æˆä»¤ç‰Œ
```http
POST /accounts/v1/token
Content-Type: application/json

{
  "account_id": "encoded_account_id",
  "session": "encrypted_session_token",
  "color": "blue"
}
```

#### åˆ·æ–°ä¼šè¯
```http
POST /accounts/v1/refresh
Content-Type: application/json

{
  "account_id": "encoded_account_id",
  "session": "current_session_token"
}
```

### å…¬å‘Šç³»ç»Ÿæ¥å£

#### è·å–å…¬å‘Šåˆ—è¡¨
```http
GET /notices/v1/list
Content-Type: application/json

{
  "page": 1,
  "size": 10
}
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æµç¨‹ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

### å¼€å‘è§„èŒƒ

- éµå¾ª Go è¯­è¨€å®˜æ–¹ä»£ç è§„èŒƒ
- ä½¿ç”¨ `golangci-lint` è¿›è¡Œä»£ç æ£€æŸ¥
- ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œä¿è¯ä»£ç è¦†ç›–ç‡ > 80%
- æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œ API è¯´æ˜
- ç¡®ä¿ CI/CD æµç¨‹é€šè¿‡

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [MIT License](https://github.com/go-pantheon/lares/blob/main/LICENSE) å¼€æºåè®®ã€‚

---

<div align="center">
âœ¨ **Lares æ¸¸æˆè´¦å·é‰´æƒæœåŠ¡** - ç”¨æˆ·è¿›å…¥æ¸¸æˆä¸–ç•Œçš„é€šè¡Œè¯

ğŸ›ï¸ _go-pantheon ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†_ ğŸ›ï¸
</div>
